import{v as e,u as t,d as s,c as i,r,j as a,m as n,B as o,t as d,n as l,l as c,w as m,i as x}from"./index-8fe229f6.js";import{A as u}from"./AdminLayout-f0953381.js";const p=()=>{const{examId:p}=e(),h=t(),{startLoading:g,stopLoading:b}=s(),{showError:j}=i(),[f,y]=r.useState(""),[v,N]=r.useState(""),[w,_]=r.useState(30),[$,q]=r.useState(0),[E,k]=r.useState(100),[A,I]=r.useState(!1),[C,O]=r.useState([]),[S,D]=r.useState(!0),[F,M]=r.useState(!1),[P,Q]=r.useState({}),[z,L]=r.useState("");r.useEffect((()=>{(async()=>{const e="fetch-exam";g(e,"Loading exam...");try{if(!p)throw new Error("Exam ID is missing");const e=await x.getExamById(p);if(e.error||!e.data)throw new Error(e.error||"Failed to load exam data");const t=e.data.exam;y(t.title),N(t.description),_(t.duration),I(t.isPublic),q(t.minAge),k(t.maxAge);const s=t.questions.map((e=>{const t=e.options.map(((t,s)=>({id:`opt_${e.id}_${s}`,text:t})));return{id:e.id,title:e.title,options:t,correctOptionId:e.correctOptionIndex>=0&&e.correctOptionIndex<t.length?t[e.correctOptionIndex].id:null}}));O(s)}catch(t){L(t.message||"Failed to load exam data. Please try again."),j(t.message||"Failed to load exam data")}finally{D(!1),b(e)}})()}),[p,h,j,g,b]);const B=()=>{O([...C,{id:`q_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:"",options:[{id:`opt_${Date.now()}_1`,text:""},{id:`opt_${Date.now()}_2`,text:""},{id:`opt_${Date.now()}_3`,text:""},{id:`opt_${Date.now()}_4`,text:""}],correctOptionId:null}])};return S?a.jsx(u,{title:"Edit Exam",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(n,{size:"lg"}),a.jsx("p",{className:"mt-4 text-gray-400",children:"Loading exam..."})]})}):z?a.jsx(u,{title:"Edit Exam",children:a.jsxs("div",{className:"bg-red-500 bg-opacity-20 border border-red-500 text-red-500 p-6 rounded-lg",children:[a.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error"}),a.jsx("p",{children:z}),a.jsx(o,{variant:"primary",className:"mt-4",onClick:()=>h("/admin/exams"),children:"Back to Exams"})]})}):a.jsxs(u,{title:"Edit Exam",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-white",children:"Edit Exam"}),a.jsx("p",{className:"text-gray-400 mt-1",children:"Update exam details and questions"})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};f.trim()||(e.title="Title is required"),v.trim()||(e.description="Description is required"),w<=0&&(e.duration="Duration must be greater than 0"),A||($<0&&(e.minAge="Minimum age cannot be negative"),E<=$&&(e.maxAge="Maximum age must be greater than minimum age"));let t=!1;return C.forEach(((s,i)=>{s.title.trim()||(e[`question_${i}_title`]="Question title is required",t=!0),s.options.forEach(((t,s)=>{t.text.trim()||(e[`question_${i}_option_${s}`]="Option text is required")})),s.correctOptionId||(e[`question_${i}_correct`]="Please select a correct answer",t=!0)})),t&&(e.questions="Please fix errors in questions"),Q(e),0===Object.keys(e).length})())return void j("Please fix the errors in the form");const t={title:f,description:v,duration:w,isPublic:A,minAge:A?0:$,maxAge:A?100:E,questions:C.map((e=>({id:e.id.startsWith("q_")?void 0:e.id,title:e.title,options:e.options.map((e=>e.text)),correctOptionIndex:e.options.findIndex((t=>t.id===e.correctOptionId))})))};M(!0);const s="update-exam";g(s,"Updating exam...");try{if(!p)throw new Error("Exam ID is missing");const e=await x.updateExam(p,t);if(e.error||!e.data)throw new Error(e.error||"Failed to update exam");h("/admin/exams",{state:{message:"Exam updated successfully!",examId:p}})}catch(i){j(i.message||"Failed to update exam. Please try again.")}finally{M(!1),b(s)}},className:"space-y-8",children:[a.jsxs("div",{className:"bg-bg-light p-6 rounded-lg shadow-md",children:[a.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Exam Details"}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{htmlFor:"title",className:"block text-gray-300 mb-1",children:"Exam Title"}),a.jsx("input",{type:"text",id:"title",value:f,onChange:e=>y(e.target.value),className:`w-full bg-bg-dark border ${P.title?"border-red-500":"border-gray-700"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent`,placeholder:"Enter exam title"}),P.title&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P.title})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{htmlFor:"description",className:"block text-gray-300 mb-1",children:"Description"}),a.jsx("textarea",{id:"description",value:v,onChange:e=>N(e.target.value),className:`w-full bg-bg-dark border ${P.description?"border-red-500":"border-gray-700"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent min-h-[100px]`,placeholder:"Enter exam description"}),P.description&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P.description})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"duration",className:"block text-gray-300 mb-1",children:"Duration (minutes)"}),a.jsx("input",{type:"number",id:"duration",value:w,onChange:e=>_(parseInt(e.target.value)||0),min:"1",className:`w-full bg-bg-dark border ${P.duration?"border-red-500":"border-gray-700"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent`}),P.duration&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P.duration})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-300 mb-3",children:"Accessibility"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("label",{className:"inline-flex items-center",children:[a.jsx("input",{type:"radio",checked:A,onChange:()=>I(!0),className:"form-radio h-5 w-5 text-accent"}),a.jsx("span",{className:"ml-2 text-white",children:"Public (All ages)"})]}),a.jsxs("label",{className:"inline-flex items-center",children:[a.jsx("input",{type:"radio",checked:!A,onChange:()=>I(!1),className:"form-radio h-5 w-5 text-accent"}),a.jsx("span",{className:"ml-2 text-white",children:"Age Restricted"})]})]})]}),!A&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"minAge",className:"block text-gray-300 mb-1",children:"Min Age"}),a.jsx("input",{type:"number",id:"minAge",value:$,onChange:e=>q(parseInt(e.target.value)||0),min:"0",className:`w-full bg-bg-dark border ${P.minAge?"border-red-500":"border-gray-700"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent`}),P.minAge&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P.minAge})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"maxAge",className:"block text-gray-300 mb-1",children:"Max Age"}),a.jsx("input",{type:"number",id:"maxAge",value:E,onChange:e=>k(parseInt(e.target.value)||0),min:"1",className:`w-full bg-bg-dark border ${P.maxAge?"border-red-500":"border-gray-700"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent`}),P.maxAge&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P.maxAge})]})]})]})]}),a.jsxs("div",{className:"bg-bg-light p-6 rounded-lg shadow-md",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-white",children:"Questions"}),a.jsxs(o,{type:"button",variant:"primary",onClick:B,className:"flex items-center gap-2",children:[a.jsx(d,{})," Add Question"]})]}),P.questions&&a.jsx("div",{className:"mb-4 p-3 bg-red-500 bg-opacity-20 border border-red-500 rounded-lg text-red-500",children:P.questions}),a.jsx("div",{className:"space-y-6",children:C.map(((e,t)=>a.jsxs("div",{className:"bg-bg-dark p-5 rounded-lg border border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-lg font-medium text-white",children:["Question #",t+1]}),a.jsx("button",{type:"button",onClick:()=>{return t=e.id,void(C.length<=1?j("You must have at least one question"):O(C.filter((e=>e.id!==t))));var t},className:"text-red-500 hover:text-red-400 p-1 rounded-full hover:bg-red-500 hover:bg-opacity-10",title:"Remove question",children:a.jsx(l,{size:18})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:`question-${e.id}`,className:"block text-gray-300 mb-1",children:"Question Title"}),a.jsx("input",{type:"text",id:`question-${e.id}`,value:e.title,onChange:t=>{return s=e.id,i=t.target.value,void O(C.map((e=>e.id===s?{...e,title:i}:e)));var s,i},className:`w-full bg-bg-dark border ${P[`question_${t}_title`]?"border-red-500":"border-gray-600"} rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent`,placeholder:"Enter question title"}),P[`question_${t}_title`]&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P[`question_${t}_title`]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-gray-300",children:"Answer Options"}),a.jsxs("button",{type:"button",onClick:()=>(e=>{const t=C.find((t=>t.id===e));if(!t)return;if(t.options.length>=8)return void j("Maximum 8 options per question");const s={id:`opt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:""};O(C.map((t=>t.id===e?{...t,options:[...t.options,s]}:t)))})(e.id),className:"text-xs flex items-center gap-1 text-primary hover:text-primary-light",children:[a.jsx(d,{size:14})," Add Option"]})]}),a.jsx("div",{className:"space-y-3",children:e.options.map(((s,i)=>a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex-grow",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:s.text,onChange:t=>{return i=e.id,r=s.id,a=t.target.value,void O(C.map((e=>e.id===i?{...e,options:e.options.map((e=>e.id===r?{...e,text:a}:e))}:e)));var i,r,a},className:`w-full bg-bg-dark border ${P[`question_${t}_option_${i}`]?"border-red-500":"border-gray-600"} rounded-lg px-4 py-2 text-white focus:outline-none focus:border-accent`,placeholder:`Option ${i+1}`}),a.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s=C.find((t=>t.id===e));if(!s)return;if(s.options.length<=2)return void j("Minimum 2 options per question");const i=s.correctOptionId===t?null:s.correctOptionId;O(C.map((s=>s.id===e?{...s,options:s.options.filter((e=>e.id!==t)),correctOptionId:i}:s)))})(e.id,s.id),className:"text-gray-500 hover:text-red-400 p-1",title:"Remove option",children:a.jsx(c,{size:18})})]}),P[`question_${t}_option_${i}`]&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:P[`question_${t}_option_${i}`]})]}),a.jsx("button",{type:"button",onClick:()=>{return t=e.id,i=s.id,void O(C.map((e=>e.id===t?{...e,correctOptionId:i}:e)));var t,i},className:"w-10 h-10 rounded-full flex items-center justify-center border "+(e.correctOptionId===s.id?"bg-green-500 bg-opacity-20 border-green-500 text-green-500":"bg-transparent border-gray-600 text-gray-400"),title:e.correctOptionId===s.id?"Correct answer":"Set as correct answer",children:a.jsx(m,{size:18})})]},s.id)))}),P[`question_${t}_correct`]&&a.jsx("div",{className:"text-red-500 text-sm mt-2",children:P[`question_${t}_correct`]})]})]},e.id)))}),C.length<1&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-gray-400 mb-4",children:"No questions found. Add your first question."}),a.jsxs(o,{type:"button",variant:"primary",onClick:B,children:[a.jsx(d,{className:"mr-2"})," Add Question"]})]})]}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx(o,{type:"button",variant:"secondary",onClick:()=>h("/admin/exams"),children:"Cancel"}),a.jsx(o,{type:"submit",variant:"primary",disabled:F,children:"Update Exam"})]})]})]})};export{p as default};
