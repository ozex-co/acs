import{u as e,d as a,c as s,r as t,j as l,B as i,o as r,m as c,p as n,n as d,q as o,i as m,A as x,s as h}from"./index-8fe229f6.js";import{A as p}from"./AdminLayout-f0953381.js";import{a as g}from"./apiHelpers-d6ace334.js";const b=()=>{const b=e(),{startLoading:u,stopLoading:j}=a(),{showError:y}=s(),[N,f]=t.useState([]),[v,w]=t.useState(!0),[k,A]=t.useState(""),[C,S]=t.useState(!1),[P,T]=t.useState(null),[z,E]=t.useState(new Set),[R,U]=t.useState(!1),[$,F]=t.useState({isPublic:void 0,minAge:void 0,maxAge:void 0,applyToPublic:!1,applyToAgeRange:!1}),[D,L]=t.useState(!1),[B,O]=t.useState(!1),[q,I]=t.useState({format:"csv",all:!0}),[M,H]=t.useState(!1);t.useEffect((()=>{Q()}),[]);const Q=async()=>{w(!0);const e="fetch-admin-exams";u(e,"جاري تحميل الاختبارات...");try{const e=await g.getExams();if(e.error)throw new Error(e.error);let a=[];e.data&&(Array.isArray(e.data)?a=e.data:e.data.exams&&Array.isArray(e.data.exams)?a=e.data.exams:e.data.data&&Array.isArray(e.data.data)?a=e.data.data:e.data.data&&e.data.data.exams&&Array.isArray(e.data.data.exams)&&(a=e.data.data.exams)),f(a),a.length}catch(a){A("فشل في تحميل الاختبارات"),y("فشل في تحميل الاختبارات")}finally{w(!1),j(e)}},V=()=>{b("/admin/exams/create")},_=e=>{b(`/admin/exams/edit/${e}`)},G=e=>{T(e)},J=()=>{T(null)},K=async e=>{S(!0);const a="delete-exam";u(a,"جاري حذف الاختبار...");try{const a=await g.deleteExam(e);if(a.error)throw new Error(a.error);f(N.filter((a=>a.id!==e))),T(null)}catch(s){y("فشل في حذف الاختبار")}finally{S(!1),j(a)}},W=e=>{e.target.checked?E(new Set(N.map((e=>e.id)))):E(new Set)},X=(e,a)=>{E((s=>{const t=new Set(s);return a?t.add(e):t.delete(e),t}))},Y=N.length>0&&z.size===N.length,Z=e=>{const{name:a,value:s,type:t}=e.target;if("checkbox"===t){const s=e.target.checked;F((e=>({...e,[a]:s})))}else F("isPublic"===a?e=>({...e,isPublic:"true"===s||"false"!==s&&void 0}):e=>({...e,[a]:s}))},ee=()=>{I({format:"csv",all:!0}),O(!0)},ae=e=>{const{name:a,value:s,type:t}=e.target;"radio"===t&&"exportScope"===a?I((e=>({...e,all:"all"===s}))):"format"===a&&I((e=>({...e,format:s})))};return l.jsxs(p,{title:"إدارة الاختبارات",children:[l.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:"إدارة الاختبارات"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(i,{variant:"secondary",onClick:ee,children:[l.jsx(r,{className:"mr-2"}),"Export"]}),l.jsx(i,{variant:"primary",onClick:V,children:"إضافة اختبار جديد"})]})]}),l.jsx("div",{className:"bg-bg-light p-6 rounded-lg shadow-md",children:v?l.jsx("div",{className:"flex justify-center items-center py-12",children:l.jsx(c,{size:"lg"})}):k?l.jsx("div",{className:"text-center py-8 text-red-500",children:k}):0===N.length?l.jsx("div",{className:"text-center py-8 text-gray-400",children:"No exams found. Create your first exam to get started."}):l.jsx(l.Fragment,{children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full text-white",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b border-gray-700",children:[l.jsx("th",{className:"p-3 text-left w-10",children:l.jsx("input",{type:"checkbox",checked:Y,onChange:W,className:"form-checkbox h-5 w-5 text-accent bg-bg-dark border-gray-600 rounded"})}),l.jsx("th",{className:"p-3 text-left",children:"Title"}),l.jsx("th",{className:"p-3 text-left",children:"Questions"}),l.jsx("th",{className:"p-3 text-left",children:"Duration"}),l.jsx("th",{className:"p-3 text-left",children:"Age Range"}),l.jsx("th",{className:"p-3 text-left",children:"Created"}),l.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),l.jsx("tbody",{children:N.map((e=>{var a;if(!e||"object"!=typeof e)return null;const s=(null==(a=e.id)?void 0:a.toString())||"",t=e.title||"Untitled Exam",i=e.questionsCount||0,r=e.duration||0,c=e.minAge??0,o=e.maxAge??100,m=e.createdAt||"";return l.jsxs("tr",{className:"border-b border-gray-800 hover:bg-bg-dark/30",children:[l.jsx("td",{className:"p-3",children:l.jsx("input",{type:"checkbox",checked:z.has(s),onChange:e=>X(s,e.target.checked),className:"form-checkbox h-5 w-5 text-accent bg-bg-dark border-gray-600 rounded"})}),l.jsx("td",{className:"p-3",children:t}),l.jsx("td",{className:"p-3",children:i}),l.jsxs("td",{className:"p-3",children:[r," min"]}),l.jsx("td",{className:"p-3",children:e.isPublic?"Public":`${c} - ${100===o?"∞":o}`}),l.jsx("td",{className:"p-3",children:new Date(m).toLocaleDateString()}),l.jsx("td",{className:"p-3",children:l.jsxs("div",{className:"flex space-x-2",children:[l.jsx("button",{onClick:()=>_(s),className:"text-blue-400 hover:text-blue-300",title:"Edit",children:l.jsx(n,{size:18})}),l.jsx("button",{onClick:()=>G(s),className:"text-red-400 hover:text-red-300",title:"Delete",children:l.jsx(d,{size:18})})]})})]},s)}))})]})})})}),P&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-bg-dark p-6 rounded-lg shadow-lg max-w-md w-full",children:[l.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Confirm Delete"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Are you sure you want to delete this exam? This action cannot be undone."}),l.jsxs("div",{className:"flex justify-end space-x-4",children:[l.jsx(i,{variant:"secondary",onClick:J,disabled:C,children:"Cancel"}),l.jsx(i,{variant:"danger",onClick:()=>K(P),loading:C,children:"Delete"})]})]})}),v?l.jsxs("div",{className:"text-center py-12",children:[l.jsx(c,{size:"lg"}),l.jsx("p",{className:"mt-4 text-gray-400",children:"جاري تحميل الاختبارات..."})]}):k?l.jsx("div",{className:"bg-red-500 bg-opacity-20 border border-red-500 text-red-500 p-4 rounded-lg",children:k}):0===N.length?l.jsxs("div",{className:"bg-bg-light p-8 rounded-lg text-center",children:[l.jsx("p",{className:"text-gray-400 mb-4",children:"لا توجد اختبارات حالياً"}),l.jsx(i,{variant:"primary",onClick:V,children:"إضافة اختبار جديد"})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"mb-4 p-3 bg-bg-light rounded-lg border border-gray-700 flex items-center gap-4",children:[l.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-primary bg-bg-dark border-gray-600 rounded focus:ring-primary",checked:Y,onChange:W,"aria-label":"Select all exams"}),l.jsxs("span",{className:"text-gray-400 text-sm",children:[z.size," selected"]}),z.size>0&&l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(i,{variant:"secondary",size:"sm",onClick:ee,children:[l.jsx(o,{className:"mr-2"}),"Export Selected"]}),l.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>{0!==z.size?U(!0):y("Please select at least one exam to update")},children:[l.jsx(n,{className:"mr-2"}),"Bulk Update"]}),l.jsxs(i,{variant:"danger",size:"sm",onClick:async()=>{if(0===z.size)return;if(!window.confirm(`Are you sure you want to delete ${z.size} selected exams? This action cannot be undone.`))return;const e=Array.from(z);S(!0);const a="delete-selected-exams";u(a,`جاري حذف ${z.size} اختبار...`);try{const a=e.map((e=>g.deleteExam(e)));await Promise.all(a),f((e=>e.filter((e=>!z.has(e.id))))),E(new Set)}catch(s){y("فشل في حذف الاختبارات المحددة")}finally{S(!1),j(a)}},children:[l.jsx(d,{className:"mr-2"}),"Delete Selected"]})]})]}),l.jsx("div",{className:"grid gap-6",children:N.map((e=>l.jsxs("div",{className:"bg-bg-light p-6 rounded-lg shadow-md relative border border-transparent hover:border-primary transition-colors",children:[l.jsx("div",{className:"absolute top-3 right-3 z-10",children:l.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-primary bg-bg-dark border-gray-600 rounded focus:ring-primary",checked:z.has(e.id),onChange:a=>X(e.id,a.target.checked),"aria-labelledby":`exam-title-${e.id}`})}),P===e.id&&l.jsx("div",{className:"absolute inset-0 bg-bg-dark bg-opacity-90 rounded-lg flex items-center justify-center z-10",children:l.jsxs("div",{className:"bg-bg-light p-6 rounded-lg max-w-md w-full",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"تأكيد الحذف"}),l.jsxs("p",{className:"text-gray-400 mb-6",children:['هل أنت متأكد من حذف الاختبار "',e.title,'"؟ هذا الإجراء لا يمكن التراجع عنه.']}),l.jsxs("div",{className:"flex gap-4",children:[l.jsx(i,{variant:"danger",disabled:C,onClick:()=>K(e.id),className:"w-1/2",children:"حذف"}),l.jsx(i,{variant:"secondary",disabled:C,onClick:J,className:"w-1/2",children:"إلغاء"})]})]})}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h2",{id:`exam-title-${e.id}`,className:"text-xl font-bold text-white mb-2",children:e.title}),l.jsx("p",{className:"text-gray-400",children:e.description})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[l.jsxs("div",{className:"bg-bg-dark p-3 rounded-lg",children:[l.jsx("span",{className:"text-gray-400 block mb-1",children:"عدد الأسئلة"}),l.jsx("span",{className:"text-lg font-medium text-white",children:e.questionsCount})]}),l.jsxs("div",{className:"bg-bg-dark p-3 rounded-lg",children:[l.jsx("span",{className:"text-gray-400 block mb-1",children:"مدة الاختبار"}),l.jsxs("span",{className:"text-lg font-medium text-white",children:[e.duration," دقيقة"]})]}),l.jsxs("div",{className:"bg-bg-dark p-3 rounded-lg",children:[l.jsx("span",{className:"text-gray-400 block mb-1",children:"الفئة العمرية"}),l.jsxs("span",{className:"text-lg font-medium text-white",children:[e.minAge," - ",e.maxAge," سنة"]})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx(i,{variant:"secondary",onClick:()=>_(e.id),children:"تعديل"}),l.jsx(i,{variant:"danger",onClick:()=>G(e.id),children:"حذف"})]})]},e.id)))}),R&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-bg-light p-6 rounded-lg max-w-md w-full",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Bulk Update Exams"}),l.jsxs("p",{className:"text-gray-400 mb-4",children:["Update properties for ",z.size," selected exams"]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center mb-2",children:[l.jsx("input",{type:"checkbox",id:"applyToPublic",name:"applyToPublic",checked:$.applyToPublic,onChange:Z,className:"mr-2 h-4 w-4"}),l.jsx("label",{htmlFor:"applyToPublic",className:"text-white",children:"Update Public/Private Status"})]}),$.applyToPublic&&l.jsxs("select",{name:"isPublic",value:void 0===$.isPublic?"":$.isPublic.toString(),onChange:Z,className:"w-full bg-bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white",disabled:!$.applyToPublic,children:[l.jsx("option",{value:"",children:"-- Select --"}),l.jsx("option",{value:"true",children:"Public (All ages)"}),l.jsx("option",{value:"false",children:"Age Restricted"})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center mb-2",children:[l.jsx("input",{type:"checkbox",id:"applyToAgeRange",name:"applyToAgeRange",checked:$.applyToAgeRange,onChange:Z,className:"mr-2 h-4 w-4"}),l.jsx("label",{htmlFor:"applyToAgeRange",className:"text-white",children:"Update Age Range"})]}),$.applyToAgeRange&&l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"minAge",className:"block text-gray-400 mb-1",children:"Min Age"}),l.jsx("input",{type:"number",id:"minAge",name:"minAge",value:$.minAge||"",onChange:Z,className:"w-full bg-bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white",disabled:!$.applyToAgeRange,min:"0"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"maxAge",className:"block text-gray-400 mb-1",children:"Max Age"}),l.jsx("input",{type:"number",id:"maxAge",name:"maxAge",value:$.maxAge||"",onChange:Z,className:"w-full bg-bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white",disabled:!$.applyToAgeRange,min:"1"})]})]})]})]}),l.jsxs("div",{className:"flex gap-4 mt-6",children:[l.jsx(i,{variant:"primary",onClick:async()=>{const e=Array.from(z);if(!$.applyToPublic&&!$.applyToAgeRange)return void y("Please select at least one property to update");if($.applyToAgeRange){if(!$.minAge||!$.maxAge)return void y("Please provide both minimum and maximum age");if(Number($.minAge)>=Number($.maxAge))return void y("Minimum age must be less than maximum age")}L(!0);const a="bulk-update-exams";u(a,`Updating ${e.length} exams...`);try{const a={};$.applyToPublic&&(a.isPublic=$.isPublic),$.applyToAgeRange&&(a.minAge=Number($.minAge),a.maxAge=Number($.maxAge));const s=e.map((e=>m.updateExam(e,a)));await Promise.all(s),f((e=>e.map((e=>z.has(e.id)?{...e,...$.applyToPublic?{isPublic:$.isPublic}:{},...$.applyToAgeRange?{minAge:Number($.minAge),maxAge:Number($.maxAge)}:{}}:e)))),U(!1),F({isPublic:void 0,minAge:void 0,maxAge:void 0,applyToPublic:!1,applyToAgeRange:!1})}catch(s){y("Failed to update the selected exams")}finally{L(!1),j(a)}},disabled:D||!$.applyToPublic&&!$.applyToAgeRange,className:"w-1/2",children:D?"Updating...":"Update Exams"}),l.jsx(i,{variant:"secondary",onClick:()=>U(!1),disabled:D,className:"w-1/2",children:"Cancel"})]})]})}),B&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-bg-light p-6 rounded-lg max-w-md w-full",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Export Exams"}),l.jsx("p",{className:"text-gray-400 mb-4",children:"Select export format and options"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-white mb-2",children:"Export Format"}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"inline-flex items-center",children:[l.jsx("input",{type:"radio",name:"format",value:"csv",checked:"csv"===q.format,onChange:ae,className:"mr-2 h-4 w-4"}),l.jsx("span",{className:"text-white",children:"CSV"})]}),l.jsxs("label",{className:"inline-flex items-center",children:[l.jsx("input",{type:"radio",name:"format",value:"pdf",checked:"pdf"===q.format,onChange:ae,className:"mr-2 h-4 w-4"}),l.jsx("span",{className:"text-white",children:"PDF"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white mb-2",children:"Export Scope"}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"inline-flex items-center",children:[l.jsx("input",{type:"radio",name:"exportScope",value:"all",checked:q.all,onChange:ae,className:"mr-2 h-4 w-4"}),l.jsxs("span",{className:"text-white",children:["All Exams (",N.length,")"]})]}),l.jsxs("label",{className:"inline-flex items-center",children:[l.jsx("input",{type:"radio",name:"exportScope",value:"selected",checked:!q.all,onChange:ae,className:"mr-2 h-4 w-4"}),l.jsxs("span",{className:"text-white",children:["Selected (",z.size,")"]})]})]})]})]}),l.jsxs("div",{className:"flex gap-4 mt-6",children:[l.jsx(i,{variant:"primary",onClick:async()=>{if(!q.all&&0===z.size)return void y("Please select at least one exam to export");H(!0);const e="export-exams";u(e,`Exporting exams as ${q.format.toUpperCase()}...`);try{const e=localStorage.getItem("adminToken");if(!e)return void b("/admin/login");const a=`${x.BASE_URL}/admin/exams/export/${q.format}`,s=q.all?{}:{examIds:Array.from(z)},t=await h({url:a,method:"POST",data:s,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},responseType:"blob"}),l=new Blob([t.data],{type:"csv"===q.format?"text/csv":"application/pdf"}),i=window.URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=`exams-export-${(new Date).toISOString().split("T")[0]}.${q.format}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i),O(!1)}catch(a){y(`Failed to export exams as ${q.format.toUpperCase()}`)}finally{H(!1),j(e)}},disabled:M||!q.all&&0===z.size,className:"w-1/2",children:M?"Exporting...":"Export"}),l.jsx(i,{variant:"secondary",onClick:()=>O(!1),disabled:M,className:"w-1/2",children:"Cancel"})]})]})})]})]})};export{b as default};
