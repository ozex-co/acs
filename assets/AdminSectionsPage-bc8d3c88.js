import{r as e,d as r,c as a,j as t,B as s,D as o}from"./index-8fe229f6.js";import{A as d}from"./AdminLayout-f0953381.js";import{a as n}from"./apiHelpers-d6ace334.js";const i=()=>{const[i,l]=e.useState([]),[c,x]=e.useState(!0),[g,h]=e.useState(""),{startLoading:m,stopLoading:y}=r(),{showError:b}=a(),[p,k]=e.useState(!1),[u,f]=e.useState(null),[j,w]=e.useState({name:"",description:""}),v=async()=>{x(!0);const e="fetch-sections";m(e,"Loading sections...");try{const e=await n.getSections();if(e.error)throw new Error(e.error);if(!e.data||!e.data.sections)throw new Error("Invalid response format");l(e.data.sections||[])}catch(r){h("Failed to fetch sections. Please try again."),b("Error fetching sections: "+(r instanceof Error?r.message:"Unknown error"))}finally{x(!1),y(e)}};e.useEffect((()=>{v()}),[]);const N=e=>{const{name:r,value:a}=e.target;w({...j,[r]:a})};return t.jsx(d,{children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"إدارة الأقسام"}),t.jsxs(s,{variant:"primary",onClick:()=>{w({name:"",description:""}),f(null),k(!0)},className:"flex items-center",children:[t.jsx("span",{className:"mr-2",children:"+"}),"إضافة قسم جديد"]})]}),p&&t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-6 border border-gray-200 dark:border-gray-700",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:u?"تعديل القسم":"إضافة قسم جديد"}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!j.name.trim())return void b("اسم القسم مطلوب");const r=(u?"update":"create")+"-section";m(r,`جاري ${u?"تحديث":"إنشاء"} القسم...`);try{let e;if(e=u?await n.updateSection(u.id,j):await n.createSection(j),e.error)throw new Error(e.error);await v(),k(!1)}catch(a){b(a.message||`فشل في ${u?"تحديث":"إنشاء"} القسم`)}finally{y(r)}},children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"name",className:"block mb-1 text-gray-700 dark:text-gray-300",children:"اسم القسم"}),t.jsx("input",{type:"text",id:"name",name:"name",value:j.name,onChange:N,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"مثال: العلوم، الرياضيات، ...",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"description",className:"block mb-1 text-gray-700 dark:text-gray-300",children:"وصف القسم"}),t.jsx("textarea",{id:"description",name:"description",value:j.description,onChange:N,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"اكتب وصفاً مختصراً للقسم...",rows:3})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(s,{type:"button",variant:"secondary",onClick:()=>k(!1),className:"ml-3",children:"إلغاء"}),t.jsx(s,{type:"submit",variant:"primary",children:u?"تحديث":"إضافة"})]})]})]}),t.jsx(o,{isLoading:c,error:g,isEmpty:0===i.length,emptyMessage:"لا توجد أقسام حالياً. قم بإضافة قسم جديد للبدء.",loadingId:"fetch-sections",skeletonType:"table",skeletonRows:5,children:t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300 font-semibold border-b border-gray-200 dark:border-gray-600",children:"الاسم"}),t.jsx("th",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300 font-semibold border-b border-gray-200 dark:border-gray-600",children:"الوصف"}),t.jsx("th",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300 font-semibold border-b border-gray-200 dark:border-gray-600",children:"تاريخ الإنشاء"}),t.jsx("th",{className:"py-3 px-4 text-center text-gray-700 dark:text-gray-300 font-semibold border-b border-gray-200 dark:border-gray-600",children:"إجراءات"})]})}),t.jsx("tbody",{children:i.map((e=>t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[t.jsx("td",{className:"py-3 px-4 border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-300",children:e.name}),t.jsx("td",{className:"py-3 px-4 border-b border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400",children:e.description||"-"}),t.jsx("td",{className:"py-3 px-4 border-b border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400",children:new Date(e.createdAt).toLocaleDateString("ar-EG")}),t.jsx("td",{className:"py-3 px-4 border-b border-gray-200 dark:border-gray-600 text-center",children:t.jsxs("div",{className:"flex justify-center space-x-2",children:[t.jsx("button",{onClick:()=>(e=>{w({name:e.name,description:e.description}),f(e),k(!0)})(e),className:"p-1 text-sky-600 hover:text-sky-800 dark:text-sky-400 dark:hover:text-sky-300 focus:outline-none ml-2",title:"تعديل",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("button",{onClick:()=>(async e=>{if(!window.confirm("هل أنت متأكد من حذف هذا القسم؟"))return;const r="delete-section";m(r,"جاري حذف القسم...");try{const r=await n.deleteSection(e);if(r.error)throw new Error(r.error);await v()}catch(a){b(a.message||"فشل في حذف القسم")}finally{y(r)}})(e.id),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 focus:outline-none",title:"حذف",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id)))})]})})})]})})};export{i as default};
