import{u as e,a as t,d as s,c as a,r,i as l,j as i,B as n,k as d,l as c,m as o,n as x}from"./index-8fe229f6.js";import{A as m}from"./AdminLayout-f0953381.js";const h=e=>{const t=new Date(e),s=new Date;let a=s.getFullYear()-t.getFullYear();const r=s.getMonth()-t.getMonth();return(r<0||0===r&&s.getDate()<t.getDate())&&a--,a},u=()=>{const u=e(),g=t(),{startLoading:p,stopLoading:y}=s(),{showError:f}=a(),[j,b]=r.useState([]),[N,w]=r.useState([]),[v,k]=r.useState(!0),[C,S]=r.useState(""),[D,L]=r.useState(""),[F,A]=r.useState(null),[E,B]=r.useState(!1),[U,$]=r.useState(!1),[I,P]=r.useState(1),[T,O]=r.useState(""),z=new URLSearchParams(g.search).get("highlight");r.useEffect((()=>{M()}),[]),r.useEffect((()=>{if(""===D.trim())w(j);else{const e=D.toLowerCase(),t=j.filter((t=>t.fullName.toLowerCase().includes(e)||t.phone.includes(e)||t.email&&t.email.toLowerCase().includes(e)));w(t)}}),[D,j]);const M=async()=>{const e="fetch-admin-users";p(e,"Loading users...");try{const e=await l.getUsers(I,10,T);if(e.error)throw new Error(e.error);const t=(e.data.users||[]).map((e=>({...e,age:e.dateOfBirth?h(e.dateOfBirth):0})));if(b(t),w(t),z){t.find((e=>e.id===parseInt(z)))&&setTimeout((()=>{const e=document.getElementById(`user-${z}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("animate-highlight"))}),500)}}catch(t){S("Failed to load users. Please try again."),f("Failed to load users")}finally{k(!1),y(e)}},V=()=>{B(!1),A(null)},Y=e=>{const t=new Date(e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(t)};return i.jsxs(m,{title:"Users",children:[i.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-white",children:"Users Management"}),i.jsx("p",{className:"text-gray-400 mt-1",children:"View and manage system users"})]}),i.jsx(n,{onClick:()=>u("/admin/dashboard"),variant:"secondary",children:"Back to Dashboard"})]}),i.jsxs("div",{className:"mb-6 relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(d,{className:"text-gray-400"})}),i.jsx("input",{type:"text",value:D,onChange:e=>L(e.target.value),placeholder:"Search by name, phone, or email...",className:"w-full pl-10 pr-10 py-3 bg-bg-light border border-gray-700 rounded-lg text-white focus:outline-none focus:border-primary"}),D&&i.jsx("button",{onClick:()=>L(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white",children:i.jsx(c,{})})]}),v?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(o,{size:"lg"}),i.jsx("p",{className:"mt-4 text-gray-400",children:"Loading users..."})]}):C?i.jsxs("div",{className:"bg-red-500 bg-opacity-20 border border-red-500 text-red-500 p-6 rounded-lg",children:[i.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error"}),i.jsx("p",{children:C}),i.jsx(n,{variant:"primary",className:"mt-4",onClick:M,children:"Try Again"})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"bg-bg-light p-4 rounded-lg mb-4",children:i.jsxs("p",{className:"text-gray-400",children:["Total users: ",i.jsx("span",{className:"text-white font-medium",children:j.length}),D&&i.jsxs("span",{children:[", Filtered: ",i.jsx("span",{className:"text-white font-medium",children:N.length})]})]})}),i.jsx("div",{className:"bg-bg-light rounded-lg shadow-md overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[i.jsx("thead",{className:"bg-bg-dark",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Name"}),i.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Phone"}),i.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden md:table-cell",children:"Email"}),i.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden sm:table-cell",children:"Age"}),i.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider hidden lg:table-cell",children:"Joined"}),i.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),i.jsx("tbody",{className:"divide-y divide-gray-700",children:0===N.length?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-400",children:D?"No users match your search":"No users found"})}):N.map((e=>i.jsxs("tr",{id:`user-${e.id}`,className:"border-b border-gray-700 hover:bg-bg-dark cursor-pointer "+(z&&parseInt(z)===e.id?"bg-bg-dark":""),onClick:()=>u(`/admin/users/${e.id}`),children:[i.jsx("td",{className:"py-3 px-2 text-white",children:e.fullName}),i.jsx("td",{className:"py-3 px-2 text-gray-300",children:e.phone||"-"}),i.jsx("td",{className:"py-3 px-2 text-gray-300 hidden md:table-cell",children:e.email||"-"}),i.jsx("td",{className:"py-3 px-2 text-gray-300 hidden sm:table-cell",children:e.dateOfBirth?`${e.age||h(e.dateOfBirth)} سنة`:"-"}),i.jsx("td",{className:"py-3 px-2 text-gray-300 hidden lg:table-cell",children:e.createdAt?Y(e.createdAt):"-"}),i.jsx("td",{className:"py-3 px-2 text-right",children:i.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{A(e),B(!0)})(e)},className:"text-red-500 hover:text-red-400 p-1","aria-label":"Delete user",children:i.jsx(x,{})})})]},e.id)))})]})})})]}),E&&F&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:V}),i.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-bg-light p-6 rounded-lg shadow-xl max-w-md w-full",children:[i.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Confirm Delete"}),i.jsxs("p",{className:"text-gray-300 mb-6",children:["Are you sure you want to delete the user ",i.jsx("span",{className:"font-semibold text-white",children:F.fullName}),"? This action cannot be undone."]}),i.jsxs("div",{className:"flex justify-end gap-4",children:[i.jsx(n,{type:"button",variant:"secondary",disabled:U,onClick:V,children:"Cancel"}),i.jsx(n,{type:"button",variant:"danger",disabled:U,onClick:async()=>{if(!F)return;$(!0);const e="delete-user";p(e,`Deleting user ${F.fullName}...`);try{const e=await l.deleteUser(F.id);if(e.error)throw new Error(e.error);b(j.filter((e=>e.id!==F.id))),B(!1),f(`User ${F.fullName} was deleted successfully`)}catch(t){f("Failed to delete user. Please try again.")}finally{$(!1),A(null),y(e)}},children:"Delete"})]})]})})]})]})};export{u as default};
